From 8d46747b7a10fbc284e7838b7732672d5e813eb2 Mon Sep 17 00:00:00 2001
From: Ganesh Reddy K <ganeshreddy@freescale.com>
Date: Mon, 28 Mar 2016 02:53:55 +0530
Subject: [PATCH 38/60] SBR-1568 barebox:005-c2krv340-rtl8211_led.patch changes

Signed-off-by: Ganesh Reddy K <ganeshreddy@freescale.com>
---
 arch/arm/boards/comcerto-rv340/c2k_rv340.c | 147 ++++++++++++++---------------
 drivers/net/comcerto/c2000_eth.c           |   4 +
 2 files changed, 77 insertions(+), 74 deletions(-)

diff --git a/arch/arm/boards/comcerto-rv340/c2k_rv340.c b/arch/arm/boards/comcerto-rv340/c2k_rv340.c
index 7c8be28..9f9801f 100755
--- a/arch/arm/boards/comcerto-rv340/c2k_rv340.c
+++ b/arch/arm/boards/comcerto-rv340/c2k_rv340.c
@@ -192,6 +192,79 @@ static int c2000_device_init(void)
 	serial_plat.clock = clk * 1000 * 1000;
 	register_device(&fast_uart_device);
 
+	/* Config GPIO Select */
+	writel(readl(COMCERTO_GPIO_PIN_SELECT_REG) & 0x00000000, COMCERTO_GPIO_PIN_SELECT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_PIN_SELECT_REG) | 0x0ffff000, COMCERTO_GPIO_EXT_PIN_SELECT_REG);
+	/* Config GPIO Output Enable */
+	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_1, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_2, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_3, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_OE_REG) & ~GPIO_4, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_OE_REG) & ~GPIO_5, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_OE_REG) & ~GPIO_6, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_OE_REG) & ~GPIO_7, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_8, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_OE_REG) & ~GPIO_9, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_10, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_11, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_OE_REG) & ~GPIO_12, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_13, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_OE_REG) & ~GPIO_14, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_15, COMCERTO_GPIO_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_44, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_45, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_46, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_47, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_48, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) & ~GPIO_49, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_50, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_51, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_52, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_53, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_54, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_55, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_56, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_57, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_58, COMCERTO_GPIO_EXT_OE_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_59, COMCERTO_GPIO_EXT_OE_REG);
+	/* Config GPIO Output */
+	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_1, COMCERTO_GPIO_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_2, COMCERTO_GPIO_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_3, COMCERTO_GPIO_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_8, COMCERTO_GPIO_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_10, COMCERTO_GPIO_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_11, COMCERTO_GPIO_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_13, COMCERTO_GPIO_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_OUTPUT_REG) & ~GPIO_15, COMCERTO_GPIO_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_44, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_45, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_46, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_47, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_48, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_50, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_51, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_52, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_53, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_54, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_55, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_56, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_57, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_58, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_59, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	/* GPIO Reset External Device */
+	udelay(100000);
+	writel(readl(COMCERTO_GPIO_OUTPUT_REG) & ~GPIO_1, COMCERTO_GPIO_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_OUTPUT_REG) & ~GPIO_2, COMCERTO_GPIO_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_OUTPUT_REG) & ~GPIO_3, COMCERTO_GPIO_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) & ~GPIO_47, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) & ~GPIO_48, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	udelay(100000);
+	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_1, COMCERTO_GPIO_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_2, COMCERTO_GPIO_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_3, COMCERTO_GPIO_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_47, COMCERTO_GPIO_EXT_OUTPUT_REG);
+	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_48, COMCERTO_GPIO_EXT_OUTPUT_REG);
+
 #ifdef CONFIG_SPI
 	spi_register_board_info(c2k_spi_dev_1, ARRAY_SIZE(c2k_spi_dev_1));
 	register_device(&device_spi);
@@ -289,80 +362,6 @@ static int c2000_device_init(void)
 		devfs_add_partition("nor0", 0xA0000, 0x20000, PARTITION_FIXED, "env0");
 		protect_file("/dev/env0", 1);
 	}
-
-
-	/* Config GPIO Select */
-	writel(readl(COMCERTO_GPIO_PIN_SELECT_REG) & 0x00000000, COMCERTO_GPIO_PIN_SELECT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_PIN_SELECT_REG) | 0x0ffff000, COMCERTO_GPIO_EXT_PIN_SELECT_REG);
-	/* Config GPIO Output Enable */
-	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_1, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_2, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_3, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_OE_REG) & ~GPIO_4, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_OE_REG) & ~GPIO_5, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_OE_REG) & ~GPIO_6, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_OE_REG) & ~GPIO_7, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_8, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_OE_REG) & ~GPIO_9, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_10, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_11, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_OE_REG) & ~GPIO_12, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_13, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_OE_REG) & ~GPIO_14, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_OE_REG) | GPIO_15, COMCERTO_GPIO_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_44, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_45, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_46, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_47, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_48, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) & ~GPIO_49, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_50, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_51, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_52, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_53, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_54, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_55, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_56, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_57, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_58, COMCERTO_GPIO_EXT_OE_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OE_REG) | GPIO_59, COMCERTO_GPIO_EXT_OE_REG);
-	/* Config GPIO Output */
-	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_1, COMCERTO_GPIO_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_2, COMCERTO_GPIO_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_3, COMCERTO_GPIO_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_8, COMCERTO_GPIO_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_10, COMCERTO_GPIO_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_11, COMCERTO_GPIO_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_13, COMCERTO_GPIO_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_OUTPUT_REG) & ~GPIO_15, COMCERTO_GPIO_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_44, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_45, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_46, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_47, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_48, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_50, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_51, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_52, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_53, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_54, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_55, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_56, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_57, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_58, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_59, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	/* GPIO Reset External Device */
-	udelay(100000);
-	writel(readl(COMCERTO_GPIO_OUTPUT_REG) & ~GPIO_1, COMCERTO_GPIO_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_OUTPUT_REG) & ~GPIO_2, COMCERTO_GPIO_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_OUTPUT_REG) & ~GPIO_3, COMCERTO_GPIO_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) & ~GPIO_47, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) & ~GPIO_48, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	udelay(100000);
-	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_1, COMCERTO_GPIO_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_2, COMCERTO_GPIO_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_OUTPUT_REG) | GPIO_3, COMCERTO_GPIO_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_47, COMCERTO_GPIO_EXT_OUTPUT_REG);
-	writel(readl(COMCERTO_GPIO_EXT_OUTPUT_REG) | GPIO_48, COMCERTO_GPIO_EXT_OUTPUT_REG);
 #endif
 	return 0;
 }
diff --git a/drivers/net/comcerto/c2000_eth.c b/drivers/net/comcerto/c2000_eth.c
index 28cf5bc..4cf9c9a 100755
--- a/drivers/net/comcerto/c2000_eth.c
+++ b/drivers/net/comcerto/c2000_eth.c
@@ -449,6 +449,10 @@ static int c2000_eth_init(struct eth_device *edev)
 #if !defined(CONFIG_MACH_COMCERTO_C2K_RV340)
 		miidev_enable_rgmii_rx_delay(&priv->miidev);
 		miidev_enable_rgmii_tx_delay(&priv->miidev);
+#else
+		mii_write(&priv->miidev, priv->miidev.address, 0x1f, 0xd04);
+		mii_write(&priv->miidev, priv->miidev.address, 0x10, 0x201b);
+		mii_write(&priv->miidev, priv->miidev.address, 0x1f, 0xa42);
 #endif
 		miidev_restart_aneg(&priv->miidev);
 	}
-- 
2.7.4

